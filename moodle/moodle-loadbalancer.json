{
  "AWSTemplateFormatVersion": "2010-09-09",

  "Resources": {
    "LoadBalancer": {
      "Type" : "AWS::ElasticLoadBalancingV2::LoadBalancer",
      "Properties" : {
        "LoadBalancerAttributes" : [],
        "Name" : { "Fn::Join" : [ "-", [ { "Ref" : "AWS::StackName" },"LoadBalancer" ] ] },
        "Scheme" : "internet-facing",
        "SecurityGroups" : [ "sg-9a70fff3" ],
        "Subnets" : ["subnet-aa8a4ed1", "subnet-cb342d81", "subnet-fd12a294"],
        "Tags" : []
      }
    },

    "LoadBalancerTG": {
      "Type" : "AWS::ElasticLoadBalancingV2::TargetGroup",
      "Properties" : {
        "HealthCheckIntervalSeconds" : 30,
        "HealthCheckPath" :  "/",
        "HealthCheckPort" : "traffic-port",
        "HealthCheckProtocol" : "HTTP",
        "HealthCheckTimeoutSeconds" : 15,
        "HealthyThresholdCount" : 3,
        "Matcher" : { "HttpCode" : "303,200" },
        "Name" : { "Fn::Join" : [ "-", [ { "Ref" : "AWS::StackName" },"TargetGroup" ] ] },
        "Port" : 80,
        "Protocol" : "HTTP",
        "TargetGroupAttributes" : [
          {
            "Key": "stickiness.enabled",
            "Value": "true"
          },
          {
            "Key": "stickiness.type",
            "Value": "lb_cookie"
          }
        ],
        "UnhealthyThresholdCount" : 2,
        "VpcId" : "vpc-12de7e7b"
      }
    },

    "LoadBalancerListener": {
      "Type" : "AWS::ElasticLoadBalancingV2::Listener",
      "Properties" : {
        "DefaultActions" : [
          { "TargetGroupArn" : { "Ref" : "LoadBalancerTG" }, "Type" : "forward" }
        ],
        "LoadBalancerArn" : { "Ref" : "LoadBalancer" },
        "Port" : 80,
        "Protocol" : "HTTP"
      }
    }

  },

  "Outputs" : {
    "LoadBalancer" : {
      "Value" : { "Fn::Join" : ["", ["http://", { "Fn::GetAtt" : [ "LoadBalancer", "DNSName" ]}, "/" ]]},
      "Description" : "Load Balancer URL"
    }
  }

}